import Groq from 'groq-sdk';
import fs from 'fs';

async function generateSemanticSummary() {
  const apiKey = process.env.GROQ_API_KEY;

  if (!apiKey) {
    console.error('‚ùå GROQ_API_KEY not set');
    process.exit(1);
  }

  console.log('üîÑ Initializing Groq client...');
  const groq = new Groq({ apiKey });

  const researchData = `
PumpFun Pump Portal API Research Summary:

Service: PumpPortal - third-party Solana trading API for Pump.fun
- Trading Endpoints: Local API (self-signed, secure), Lightning API (auto-execute), WebSocket (real-time), Bonding Curve data
- Fee Structure: 0.5% trading fee + ~0.00005 SOL network gas
- Trading Operations: Buy (SOL‚Üítokens), Sell (tokens‚ÜíSOL), Deploy (0.002 SOL + gas)
- Bonding Curve Formula: price = (virtualSOL / virtualTokens)¬≤
- WebSocket Events: subscribeNewToken, subscribeCoinTrades, subscribeAccountTrade, subscribeMigration

Critical Security:
‚úÖ USE Local API (sign locally)
‚úÖ Store keys in vault
‚úÖ Simulate transactions
‚úÖ Rate limit calls

‚ùå NEVER transmit keys to API
‚ùå NEVER hardcode secrets
‚ùå NEVER use Lightning API with real keys

Documentation: 6 files (111 KB), 50+ code examples, 20+ sources, 4 integration patterns (5 min to 4 weeks)
Location: /Users/rayarroyo/IdeaProjects/hi/docs/pumpfun/
`;

  console.log('üîÑ Calling Groq API to generate semantic summary...\n');

  try {
    const message = await groq.chat.completions.create({
      model: 'llama-3.1-8b-instant',
      max_tokens: 500,
      messages: [
        {
          role: 'user',
          content: `Create a concise, memorable semantic summary (5-7 sentences) of this PumpFun API research. Focus on what it is, why it matters, critical security rules (MUST/MUST NOT do), key technical details, and implementation options. Make it useful for future context injection across projects.

${researchData}`,
        },
      ],
    });

    const summary = message.choices[0].message.content;

    console.log('‚úÖ SEMANTIC SUMMARY GENERATED BY GROQ:\n');
    console.log('‚ïê'.repeat(85));
    console.log(summary);
    console.log('‚ïê'.repeat(85));

    // Save to forever memory
    const summaryEntry = {
      id: 'pumpfun-semantic-summary-groq-2025-11-25',
      type: 'semantic_summary',
      topic: 'PumpFun Pump Portal API',
      generated_at: new Date().toISOString(),
      model: 'llama-3.1-8b-instant',
      semantic_summary: summary,
      key_takeaways: [
        'PumpPortal: third-party Solana trading with bonding curves (price = virtualSOL/virtualTokens¬≤)',
        'CRITICAL: Local API only, sign locally, store keys in vault, never transmit keys',
        'Fee: 0.5% trading + ~0.00005 SOL gas',
        '4 patterns: 5-min quick test ‚Üí 1-2h fast integration ‚Üí 4 weeks production',
        '111 KB docs, 50+ code examples, 20+ verified sources'
      ],
      relevance_tags: [
        'pumpfun',
        'solana',
        'trading-api',
        'bonding-curve',
        'security-critical',
        'blockchain',
        'production-ready'
      ],
      documentation_location: '/Users/rayarroyo/IdeaProjects/hi/docs/pumpfun/',
    };

    const memoryPath = '/Volumes/DEVLINUX/claude-forever-memory/json/snippets/pumpfun-semantic-summary-groq.json';
    fs.writeFileSync(memoryPath, JSON.stringify(summaryEntry, null, 2));

    console.log(`\n‚úÖ SAVED TO FOREVER MEMORY:`);
    console.log(`   ${memoryPath}`);
    console.log('\n   Ready for automatic context injection in future sessions!\n');
  } catch (error) {
    console.error('‚ùå Groq API Error:', error.message);
    if (error.status) console.error('   Status:', error.status);
    if (error.error) console.error('   Details:', error.error);
    process.exit(1);
  }
}

generateSemanticSummary();
